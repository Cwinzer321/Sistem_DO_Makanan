<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistem Order Delivery dengan Peta - Hitung ongkir otomatis, tentukan lokasi pelanggan, dan kirim pesanan via WhatsApp dengan mudah.">
    <meta name="keywords" content="order delivery, peta, ongkir otomatis, integrasi WhatsApp, delivery order">
    <meta name="author" content="Order Delivery Team">
    <title>Delivery Order dengan Peta | Sistem Pemesanan Online</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìç</text></svg>">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #00e6e6;
            --primary-hover: #00b3b3;
            --success-color: #4caf50;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --bg-input: #2a2a2a;
            --text-primary: #eaeaea;
            --text-secondary: #b0b0b0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #121212 0%, #1a1a1a 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navbar */
        .navbar {
            background-color: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            padding: 1rem 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--primary-color) !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar-brand i {
            font-size: 1.5rem;
        }

        .nav-link {
            color: var(--text-primary) !important;
            font-weight: 400;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem !important;
        }

        .nav-link:hover {
            color: var(--primary-color) !important;
        }

        .navbar-toggler {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .navbar-toggler:focus {
            box-shadow: 0 0 0 0.25rem rgba(0, 230, 230, 0.25);
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.85%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        /* ============================================
           JAM OPERASIONAL - REAL-TIME CLOCK & CLOSED HOURS
           Fitur untuk menampilkan jam Jakarta dan membatasi akses
           berdasarkan jam operasional (07:00 - 17:00 WIB)
           ============================================ */
        
        /* Real-time Clock in Navbar */
        .navbar-clock {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-right: 1rem;
        }

        .navbar-clock i {
            color: var(--primary-color);
        }

        .navbar-clock-time {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary-color);
        }

        @media (max-width: 991px) {
            .navbar-clock {
                margin-right: 0;
                margin-top: 0.5rem;
                justify-content: center;
                width: 100%;
            }
        }

        /* Closed Hours Message */
        .closed-hours-container {
            display: none;
            flex: 1;
            padding: 2rem 0;
            margin-top: 70px;
            min-height: calc(100vh - 70px);
            align-items: center;
            justify-content: center;
        }

        .closed-hours-card {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-width: 600px;
            margin: 0 auto;
        }

        .closed-hours-icon {
            font-size: 5rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        .closed-hours-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .closed-hours-text {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }

        .current-time-display {
            background: linear-gradient(135deg, rgba(0, 230, 230, 0.1) 0%, rgba(0, 179, 179, 0.05) 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid rgba(0, 230, 230, 0.2);
        }

        .current-time-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .current-time-value {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .operational-hours {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 1rem;
        }

        .operational-hours strong {
            color: var(--primary-color);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem 0;
            margin-top: 70px; /* Space for fixed navbar */
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, rgba(0, 230, 230, 0.1) 0%, rgba(0, 179, 179, 0.05) 100%);
            border-radius: 20px;
            padding: 3rem 2rem;
            margin-bottom: 3rem;
            text-align: center;
            border: 1px solid rgba(0, 230, 230, 0.2);
        }

        .page-title {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, #00b3b3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .page-title i {
            -webkit-text-fill-color: var(--primary-color);
            background: none;
            color: var(--primary-color);
        }

        .page-subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 0;
            font-size: 1.2rem;
            line-height: 1.8;
        }

        /* Features Section */
        .features-section {
            margin: 4rem 0;
        }

        .feature-card {
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            height: 100%;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 230, 230, 0.2);
            border-color: rgba(0, 230, 230, 0.3);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .feature-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .input-box {
            background-color: var(--bg-input);
            color: var(--text-primary);
            border: 2px solid transparent;
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .input-box:focus {
            background-color: var(--bg-input);
            color: var(--text-primary);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 230, 230, 0.25);
            outline: none;
        }

        .input-box::placeholder {
            color: var(--text-secondary);
        }

        textarea.input-box {
            font-family: 'Poppins', sans-serif;
            resize: vertical;
            min-height: 80px;
        }

        .input-group-text {
            background-color: var(--bg-input);
            border: 2px solid transparent;
            color: var(--text-secondary);
        }

        .input-group:focus-within .input-group-text {
            border-color: var(--primary-color);
        }

        .form-select.input-box {
            cursor: pointer;
        }

        .form-select.input-box option {
            background-color: var(--bg-input);
            color: var(--text-primary);
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 230, 230, 0.2);
        }

        .card-body {
            padding: 2rem;
        }

        .card-title {
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn {
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: #ffffff;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 230, 230, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: #ffffff;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #45a049 0%, #4caf50 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn i {
            margin-right: 0.5rem;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 20px;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(0, 230, 230, 0.1) 0%, rgba(0, 179, 179, 0.1) 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid rgba(0, 230, 230, 0.2);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-value {
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        /* Loading Spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
            border-width: 0.15em;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1050;
        }

        .toast {
            background-color: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        /* Footer */
        .footer {
            background-color: var(--bg-card);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            text-align: center;
            color: var(--text-secondary);
        }

        .footer-content a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-content a:hover {
            color: var(--primary-hover);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            #map {
                height: 350px;
            }

            .hero-section {
                padding: 2rem 1.5rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .page-subtitle {
                font-size: 1rem;
            }

            .features-section {
                margin: 2rem 0;
            }

            .card-body {
                padding: 1.5rem;
            }

            .menu-item {
                padding: 0.75rem;
            }

            .menu-item-image {
                height: 150px;
            }

            .menu-item-content {
                padding: 0.75rem;
            }

            .menu-item-name {
                font-size: 0.9rem;
            }

            .menu-item-price {
                font-size: 1rem;
            }

            .menu-item-description {
                font-size: 0.75rem;
            }

            .description-list li {
                font-size: 0.75rem;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* Section Divider */
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            margin: 3rem 0;
        }

        /* Badge */
        .badge-custom {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 1rem;
        }

        /* Map Container */
        .map-container {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .map-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            z-index: 1000;
            font-size: 0.85rem;
            color: var(--text-primary);
            border: 1px solid rgba(0, 230, 230, 0.2);
        }

        .map-overlay i {
            color: var(--primary-color);
            margin-right: 0.5rem;
        }

        /* Menu Items */
        .menu-item {
            background-color: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .menu-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 230, 230, 0.2);
        }

        .menu-item.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(0, 230, 230, 0.1) 0%, rgba(0, 179, 179, 0.05) 100%);
            box-shadow: 0 5px 20px rgba(0, 230, 230, 0.3);
        }

        .menu-item.selected::before {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 10;
        }

        .menu-item-image {
            width: 100%;
            height: 200px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-input) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .menu-item-image .image-placeholder {
            font-size: 4rem;
            color: var(--text-secondary);
            opacity: 0.4;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .menu-item:hover .menu-item-image img {
            transform: scale(1.1);
        }

        .menu-item-content {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .menu-item-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .menu-item-description {
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .description-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .description-list {
            list-style: none;
            padding: 0;
            margin: 0;
            color: var(--text-secondary);
        }

        .description-list li {
            padding: 0.2rem 0;
            padding-left: 1rem;
            position: relative;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .description-list li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .menu-item-price {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: auto;
        }

        /* Sticky Total Pesanan */
        #selectedItemsSummary {
            position: sticky;
            bottom: 20px;
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 230, 230, 0.2);
            z-index: 100;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            backdrop-filter: blur(10px);
        }

        .menu-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            justify-content: center;
        }

        .quantity-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.1);
        }

        .quantity-display {
            color: var(--text-primary);
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .selected-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: var(--bg-input);
            border-radius: 10px;
            margin-bottom: 0.5rem;
        }

        .selected-item-name {
            color: var(--text-primary);
            font-weight: 500;
        }

        .selected-item-details {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .selected-item-quantity {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .selected-item-price {
            color: var(--primary-color);
            font-weight: 600;
        }

        .remove-item-btn {
            background-color: transparent;
            border: none;
            color: #ff4444;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .remove-item-btn:hover {
            background-color: rgba(255, 68, 68, 0.1);
            color: #ff6666;
        }

        .menu-summary-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .menu-summary-item:last-child {
            border-bottom: none;
        }

        .menu-summary-name {
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .menu-summary-details {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Modal Detail Makanan */
        .food-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.3s ease;
        }

        .food-detail-modal.active {
            display: flex;
        }

        .food-detail-modal-content {
            background-color: var(--bg-card);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 230, 230, 0.2);
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .food-detail-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .food-detail-close:hover {
            background-color: rgba(255, 68, 68, 0.2);
            color: #ff4444;
            transform: rotate(90deg);
        }

        .food-detail-image {
            width: 100%;
            height: 300px;
            overflow: hidden;
            border-radius: 20px 20px 0 0;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-input) 100%);
        }

        .food-detail-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .food-detail-image .image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: var(--text-secondary);
            opacity: 0.4;
        }

        .food-detail-body {
            padding: 2rem;
        }

        .food-detail-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .food-detail-price {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .food-detail-description {
            margin-bottom: 2rem;
        }

        .food-detail-description-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .food-detail-description-label i {
            color: var(--primary-color);
        }

        .food-detail-description-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .food-detail-description-list li {
            background: linear-gradient(135deg, rgba(0, 230, 230, 0.1) 0%, rgba(0, 179, 179, 0.05) 100%);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: var(--text-secondary);
            border: 1px solid rgba(0, 230, 230, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .food-detail-description-list li::before {
            content: '‚úì';
            color: var(--primary-color);
            font-weight: 700;
        }

        .food-detail-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .food-detail-quantity {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            justify-content: center;
            background: linear-gradient(135deg, rgba(0, 230, 230, 0.1) 0%, rgba(0, 179, 179, 0.05) 100%);
            padding: 1rem;
            border-radius: 15px;
            border: 1px solid rgba(0, 230, 230, 0.2);
        }

        .food-detail-quantity-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 700;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .food-detail-quantity-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.1);
        }

        .food-detail-quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .food-detail-quantity-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 50px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .food-detail-modal-content {
                max-width: 100%;
                max-height: 95vh;
            }

            .food-detail-image {
                height: 250px;
            }

            .food-detail-body {
                padding: 1.5rem;
            }

            .food-detail-name {
                font-size: 1.5rem;
            }

            .food-detail-price {
                font-size: 1.5rem;
            }

            .food-detail-description-list {
                grid-template-columns: 1fr;
            }

            .food-detail-actions {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-map-marker-alt"></i>
                <span>Delivery Order</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Jam Real-time Jakarta (WIB) - Menampilkan waktu Jakarta saat ini -->
                <div class="navbar-clock">
                    <i class="fas fa-clock"></i>
                    <span>WIB:</span>
                    <span class="navbar-clock-time" id="jakartaTime">--:--:--</span>
                </div>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">
                            <i class="fas fa-home"></i> Beranda
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tentang.html">
                            <i class="fas fa-info-circle"></i> Tentang
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- ============================================
         CLOSED HOURS MESSAGE - JAM OPERASIONAL
         Pesan yang ditampilkan ketika toko tutup (di luar jam 07:00 - 17:00 WIB)
         ============================================ -->
    <div class="closed-hours-container" id="closedHoursContainer">
        <div class="container">
            <div class="closed-hours-card">
                <div class="closed-hours-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h2 class="closed-hours-title">Maaf Sedang Tutup</h2>
                <p class="closed-hours-text">
                    Maaf, kami hanya melayani pesanan dari jam <strong>07:00 - 17:00 WIB</strong>.
                    Silakan kembali pada jam operasional kami.
                </p>
                <div class="current-time-display">
                    <div class="current-time-label">Waktu Jakarta Saat Ini:</div>
                    <div class="current-time-value" id="closedHoursTime">--:--:--</div>
                    <div class="operational-hours">
                        Jam Operasional: <strong>07:00 - 17:00 WIB</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detail Makanan -->
    <div class="food-detail-modal" id="foodDetailModal">
        <div class="food-detail-modal-content">
            <button class="food-detail-close" onclick="closeFoodDetail()">
                <i class="fas fa-times"></i>
            </button>
            <div class="food-detail-image" id="foodDetailImage">
                <!-- Gambar akan diisi oleh JavaScript -->
            </div>
            <div class="food-detail-body">
                <h2 class="food-detail-name" id="foodDetailName"></h2>
                <div class="food-detail-price" id="foodDetailPrice"></div>
                <div class="food-detail-description" id="foodDetailDescription">
                    <!-- Deskripsi akan diisi oleh JavaScript -->
                </div>
                <div class="food-detail-actions">
                    <div class="food-detail-quantity">
                        <button class="food-detail-quantity-btn" id="foodDetailDecrease" onclick="decreaseQuantityFromModal()">-</button>
                        <span class="food-detail-quantity-display" id="foodDetailQuantity">0</span>
                        <button class="food-detail-quantity-btn" id="foodDetailIncrease" onclick="increaseQuantityFromModal()">+</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container">
            
            <!-- Hero Section -->
            <!-- <div class="hero-section fade-in">
                <span class="badge-custom">
                    <i class="fas fa-star"></i> Sistem
                </span>
                <h1 class="page-title">
                    <i class="fas fa-map-marked-alt"></i> Order Delivery dengan Peta
                </h1>
                <p class="page-subtitle">
                    Solusi lengkap untuk pemesanan online dengan perhitungan ongkir otomatis, 
                    integrasi peta interaktif, dan pengiriman pesanan via WhatsApp
                </p>
            </div> -->

            <!-- Menu Section -->
            <div class="row fade-in mb-4" id="menuSection">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-utensils"></i>
                                Pilih Menu
                            </h5>
                            <p class="text-muted mb-4" style="color: var(--text-secondary);">
                                Pilih makanan yang ingin Anda pesan
                            </p>
                            
                            <!-- Filter Dropdown -->
                            <div class="mb-4">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="filterFoodName" class="form-label" style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.5rem;">
                                            <i class="fas fa-filter"></i> Filter Makanan
                                        </label>
                                        <select 
                                            class="form-select input-box" 
                                            id="filterFoodName" 
                                            onchange="filterMenuByName()">
                                            <option value="all">Semua Makanan</option>
                                            <!-- Opsi makanan akan di-generate oleh JavaScript -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Makanan -->
                            <div class="mb-4">
                                <h6 style="color: var(--primary-color); margin-bottom: 1rem; font-weight: 600;">
                                    <i class="fas fa-hamburger"></i> Makanan
                                </h6>
                                <div class="row g-3" id="foodMenu">
                                    <!-- Makanan akan di-generate oleh JavaScript -->
                                </div>
                            </div>

                            <!-- Selected Items Summary -->
                            <div id="selectedItemsSummary" style="display: none; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                <h6 style="color: var(--text-primary); margin-bottom: 1rem; font-weight: 600;">
                                    <i class="fas fa-shopping-cart"></i> Pesanan Anda
                                </h6>
                                <div id="selectedItemsList" style="margin-bottom: 1rem;"></div>
                                <div class="info-box">
                                    <div class="info-item">
                                        <span class="info-label">
                                            <i class="fas fa-receipt"></i>
                                            Total Harga
                                        </span>
                                        <span class="info-value" id="totalPrice">Rp 0</span>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100 mt-3" onclick="proceedToLocation()">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Lanjutkan ke Pilih Lokasi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map Section -->
            <div id="locationSection" style="display: none;">
            <div class="row fade-in">
                <div class="col-lg-8 mb-4">
                    <div class="map-container">
                        <div class="map-overlay">
                            <i class="fas fa-info-circle"></i>
                            Klik pada peta untuk menentukan lokasi pengiriman
                        </div>
                        <div id="map"></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-map-pin"></i>
                                Cek Lokasi
                            </h5>
                            <input type="text" 
                                   class="form-control mb-3 input-box" 
                                   id="customer_coordinates" 
                                   placeholder="'Gunakan Lokasi saya' dibawah ini"
                                   onkeypress="handleCoordinateInput(event)">
                            <button class="btn btn-primary w-100 mb-3" onclick="setLocationByGeolocation()">
                                <i class="fas fa-location-arrow"></i>
                                Gunakan Lokasi Saya
                            </button>
                            <button class="btn btn-secondary w-100 mb-3" onclick="backToMenu()" style="background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); color: white;">
                                <i class="fas fa-arrow-left"></i>
                                Kembali ke Menu
                            </button>
                            
                            <!-- Menu Summary di Location Section -->
                            <div id="locationMenuSummary" style="display: none; margin-bottom: 1.5rem;">
                                <h6 style="color: var(--text-primary); margin-bottom: 1rem; font-weight: 600;">
                                    <i class="fas fa-shopping-cart"></i> Pesanan Anda
                                </h6>
                                <div class="info-box">
                                    <div id="locationMenuList"></div>
                                    <div class="info-item" style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                        <span class="info-label">
                                            <i class="fas fa-receipt"></i>
                                            Subtotal Menu
                                        </span>
                                        <span class="info-value" id="locationMenuTotal">Rp 0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="info-box">
                                <div class="info-item">
                                    <span class="info-label">
                                        <i class="fas fa-route"></i>
                                        Jarak
                                    </span>
                                    <span class="info-value" id="jarak">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">
                                        <i class="fas fa-money-bill-wave"></i>
                                        Ongkir
                                    </span>
                                    <span class="info-value" id="ongkir">-</span>
                                </div>
                                <div class="info-item" id="totalPaymentItem" style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                    <span class="info-label">
                                        <i class="fas fa-calculator"></i>
                                        Total Pembayaran
                                    </span>
                                    <span class="info-value" id="totalPayment">Rp 0</span>
                                </div>
                            </div>
                            
                            <div class="mt-3" id="noteSection" style="display: none;">
                                <!-- Dropdown Pilihan Lokasi -->
                                <div id="lokasiDropdown" style="display: none; margin-bottom: 1rem;">
                                    <label for="lokasi_select" class="form-label" style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.5rem;">
                                        <i class="fas fa-map-marker-alt"></i> Pilih Lokasi <span style="color: #dc3545;">*</span>
                                    </label>
                                    <select 
                                        class="form-control input-box" 
                                        id="lokasi_select"
                                        required
                                        style="margin-bottom: 1rem;">
                                        <option value="">-- Pilih Lokasi --</option>
                                        <option value="mekarjaya">Mekarjaya</option>
                                        <option value="bojongsari">Bojongsari</option>
                                        <option value="karangharum">Karangharum</option>
                                        <option value="karangmekar">Karangmekar</option>
                                        <option value="karangsambung">Karangsambung</option>
                                        <option value="kedungwaringin">Kedungwaringin</option>
                                        <option value="waringinjaya">Waringinjaya</option>
                                    </select>
                                    <small class="text-muted" style="color: var(--text-secondary); font-size: 0.85rem;">
                                        <i class="fas fa-info-circle"></i> Pilih lokasi pengiriman Anda (Wajib)
                                    </small>
                                </div>
                                
                                <label for="customer_name" class="form-label" style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.5rem;">
                                    <i class="fas fa-user"></i> Nama Pembeli <span style="color: #dc3545;">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    class="form-control input-box" 
                                    id="customer_name" 
                                    placeholder="Masukkan nama Anda"
                                    required
                                    style="margin-bottom: 1rem;">
                                
                                <label for="customer_note" class="form-label" style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.5rem;">
                                    <i class="fas fa-sticky-note"></i> Ada Tambahan?
                                </label>
                                <textarea 
                                    class="form-control input-box" 
                                    id="customer_note" 
                                    rows="3"
                                    placeholder="Contoh: tambahan saus cabai"
                                    style="resize: vertical; min-height: 80px;"></textarea>
                                <small class="text-muted" style="color: var(--text-secondary); font-size: 0.85rem;">
                                    <i class="fas fa-info-circle"></i> Opsional: Tambahkan catatan atau request khusus untuk pesanan Anda
                                </small>
                            </div>
                            
                            <button id="whatsappButton" class="btn btn-success w-100 mt-3" style="display: none;">
                                <i class="fab fa-whatsapp"></i>
                                Kirim ke WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <div class="section-divider"></div>

            <!-- Features Section -->
            <!-- <div class="features-section fade-in">
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-map-marked-alt"></i>
                            </div>
                            <h3 class="feature-title">Lokasi Akurat</h3>
                            <p class="feature-description">
                                Tentukan lokasi dengan mudah menggunakan peta interaktif atau koordinat GPS
                            </p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <h3 class="feature-title">Ongkir Otomatis</h3>
                            <p class="feature-description">
                                Perhitungan ongkos kirim yang akurat berdasarkan jarak real-time
                            </p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <h3 class="feature-title">Integrasi WhatsApp</h3>
                            <p class="feature-description">
                                Kirim pesanan langsung ke WhatsApp dengan informasi lengkap
                            </p>
                        </div>
                    </div>
                </div>
            </div> -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5 style="color: var(--primary-color); margin-bottom: 1rem;">
                        <i class="fas fa-map-marker-alt"></i> Delivery Order
                    </h5>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">
                        Sistem pemesanan online untuk UMKM dengan integrasi peta dan perhitungan ongkir otomatis.
                    </p>
                </div>
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5 style="color: var(--primary-color); margin-bottom: 1rem;">Tautan Cepat</h5>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 0.5rem;">
                            <a href="index.html" style="color: var(--text-secondary); text-decoration: none; transition: color 0.3s;">
                                <i class="fas fa-home" style="margin-right: 0.5rem;"></i> Beranda
                            </a>
                        </li>
                        <li style="margin-bottom: 0.5rem;">
                            <a href="tentang.html" style="color: var(--text-secondary); text-decoration: none; transition: color 0.3s;">
                                <i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i> Tentang Kami
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5 style="color: var(--primary-color); margin-bottom: 1rem;">Kontak</h5>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">
                        <i class="fab fa-whatsapp" style="color: var(--success-color); margin-right: 0.5rem;"></i>
                        WhatsApp: +62 851-5720-4233
                    </p>
                </div>
            </div>
            <div class="section-divider" style="margin: 2rem 0 1rem;"></div>
            <div class="footer-content">
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                    &copy; 2024 Delivery Order dengan Peta. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ============================================
        // VARIABEL GLOBAL
        // ============================================
        
        // Variabel untuk menyimpan instance peta dan marker
        let map;              // Instance peta Leaflet
        let restoMarker;      // Marker untuk lokasi restoran
        let customerMarker;   // Marker untuk lokasi pelanggan
        let routeLine;        // Garis rute yang menghubungkan restoran dan pelanggan
        
        // Koordinat lokasi restoran (default location)
        const restoLatLng = {
            lat: -6.251627,   // Latitude restoran
            lng: 107.246045   // Longitude restoran
        };

        // ============================================
        // JAM OPERASIONAL - KONFIGURASI
        // Set jam buka dan tutup toko (WIB - UTC+7)
        // ============================================
        const OPERATING_HOURS = {
            open: 7,   // Jam 7 pagi
            close: 17  // Jam 5 sore
        };

        // Data Menu
        const menuData = {
            foods: [
                { 
                    id: 'food1', 
                    name: 'Kimbab Isi 6', 
                    price: 15000, 
                    image: 'img/kimbab15k.jpg',
                    description: ['Nasi', 'Wortel', 'Timun', 'Telur', 'Rumput laut']
                },
                { 
                    id: 'food2', 
                    name: 'Ricebowl', 
                    price: 20000, 
                    image: 'img/ricebowl.jpg',
                    description: ['Ayam', 'Nasi', 'Saus cabe', 'Timun', 'Seledri']
                },
                { 
                    id: 'food3', 
                    name: 'ricebowl+kimbab', 
                    price: 20000, 
                    image: 'img/ricebowl+kimbab20k.jpg',
                    description: ['ricebowl', 'kimbab']
                },
                { 
                    id: 'food4', 
                    name: 'Mac and Cheese', 
                    price: 25000, 
                    image: 'img/Mac and Cheese.jpg',
                    description: ['Pasta', 'Keju', 'Susu', 'Mentega', 'Bumbu']
                },
                { 
                    id: 'food5', 
                    name: 'Kimbab Isi 4', 
                    price: 10000, 
                    image: 'img/kimbab10k.jpg',
                    description: ['Nasi', 'Wortel', 'Timun', 'Telur', 'Rumput laut']
                },
                { 
                    id: 'food6', 
                    name: 'Kimbab Isi 5', 
                    price: 15000, 
                    image: 'img/kimbabisi5.jpg',
                    description: ['Nasi', 'Wortel', 'Timun', 'Telur', 'Rumput laut']
                }
            ]
        };

        // Menyimpan pilihan menu user
        let selectedMenu = {};
        
        // Menyimpan makanan yang sudah difilter
        let filteredFoods = [...menuData.foods];

        // Menyimpan item yang sedang ditampilkan di modal
        let currentModalItemId = null;

        // ============================================
        // FUNGSI MENU - RENDER DAN HANDLING
        // ============================================
        
        /**
         * Populate dropdown filter dengan nama makanan
         */
        function populateFilterDropdown() {
            const filterDropdown = document.getElementById('filterFoodName');
            if (!filterDropdown) return;
            
            // Hapus semua opsi kecuali "Semua Makanan"
            while (filterDropdown.children.length > 1) {
                filterDropdown.removeChild(filterDropdown.lastChild);
            }
            
            // Tambahkan opsi untuk setiap makanan
            menuData.foods.forEach(food => {
                const option = document.createElement('option');
                option.value = food.id;
                option.textContent = food.name;
                filterDropdown.appendChild(option);
            });
        }
        
        /**
         * Filter menu berdasarkan nama makanan yang dipilih
         */
        function filterMenuByName() {
            const filterDropdown = document.getElementById('filterFoodName');
            const selectedValue = filterDropdown.value;
            
            if (selectedValue === 'all') {
                // Tampilkan semua makanan
                filteredFoods = [...menuData.foods];
            } else {
                // Filter berdasarkan ID makanan yang dipilih
                filteredFoods = menuData.foods.filter(food => food.id === selectedValue);
            }
            
            // Re-render menu
            renderMenu();
        }
        
        /**
         * Render menu items (makanan) ke dalam HTML
         */
        function renderMenu() {
            const foodContainer = document.getElementById('foodMenu');
            
            // Render makanan yang sudah difilter
            if (foodContainer) {
                foodContainer.innerHTML = '';
                filteredFoods.forEach(food => {
                    const menuItem = createMenuItem(food);
                    foodContainer.appendChild(menuItem);
                });
            }
        }
        
        /**
         * Membuat elemen menu item (card untuk setiap item menu)
         * @param {Object} item - Objek menu dengan id, name, price, image, dan description
         * @returns {HTMLElement} - Elemen div yang berisi menu item
         */
        function createMenuItem(item) {
            const col = document.createElement('div');
            col.className = 'col-6 col-md-6 col-lg-4';
            
            const quantity = selectedMenu[item.id]?.quantity || 0;
            const isSelected = quantity > 0;
            const imageUrl = item.image || '';
            const description = item.description || [];
            
            // Format deskripsi menjadi list
            let descriptionHTML = '';
            if (description.length > 0) {
                descriptionHTML = `
                    <div class="menu-item-description">
                        <div class="description-label">Isi:</div>
                        <ul class="description-list">
                            ${description.map(desc => `<li>${desc}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            col.innerHTML = `
                <div class="menu-item ${isSelected ? 'selected' : ''}" data-id="${item.id}" onclick="showFoodDetail('${item.id}')">
                    <div class="menu-item-image">
                        ${imageUrl ? `<img src="${imageUrl}" alt="${item.name}" onerror="handleImageError(this)">` : '<div class="image-placeholder">üçΩÔ∏è</div>'}
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-name">${item.name}</div>
                        ${descriptionHTML}
                        <div class="menu-item-price">Rp ${item.price.toLocaleString('id-ID')}</div>
                        <div class="menu-item-quantity" onclick="event.stopPropagation()">
                            <button class="quantity-btn" onclick="decreaseQuantity('${item.id}')" ${quantity === 0 ? 'style="opacity: 0.5; cursor: not-allowed;"' : ''}>-</button>
                            <span class="quantity-display" id="qty-${item.id}">${quantity}</span>
                            <button class="quantity-btn" onclick="increaseQuantity('${item.id}')">+</button>
                        </div>
                    </div>
                </div>
            `;
            
            return col;
        }

        /**
         * Menangani error saat gambar gagal dimuat
         * @param {HTMLImageElement} img - Elemen gambar yang error
         */
        function handleImageError(img) {
            // Sembunyikan gambar dan tampilkan placeholder
            img.style.display = 'none';
            const imageContainer = img.parentElement;
            if (!imageContainer.querySelector('.image-placeholder')) {
                const placeholder = document.createElement('div');
                placeholder.className = 'image-placeholder';
                placeholder.textContent = 'üçΩÔ∏è';
                imageContainer.appendChild(placeholder);
            }
        }
        
        /**
         * Meningkatkan quantity item menu
         * @param {string} itemId - ID item menu
         */
        function increaseQuantity(itemId) {
            if (!selectedMenu[itemId]) {
                selectedMenu[itemId] = { quantity: 0 };
            }
            selectedMenu[itemId].quantity++;
            updateMenuDisplay();
            updateSelectedItemsSummary();
            updateLocationMenuDisplay();
            updateTotalPayment();
        }
        
        /**
         * Mengurangi quantity item menu
         * @param {string} itemId - ID item menu
         */
        function decreaseQuantity(itemId) {
            if (!selectedMenu[itemId] || selectedMenu[itemId].quantity <= 0) {
                return;
            }
            selectedMenu[itemId].quantity--;
            if (selectedMenu[itemId].quantity === 0) {
                delete selectedMenu[itemId];
            }
            updateMenuDisplay();
            updateSelectedItemsSummary();
            updateLocationMenuDisplay();
            updateTotalPayment();
        }
        
        /**
         * Update tampilan menu setelah perubahan quantity
         */
        function updateMenuDisplay() {
            // Update semua menu items
            const allItems = [...menuData.foods];
            allItems.forEach(item => {
                const quantity = selectedMenu[item.id]?.quantity || 0;
                const menuItemElement = document.querySelector(`.menu-item[data-id="${item.id}"]`);
                const quantityDisplay = document.getElementById(`qty-${item.id}`);
                const decreaseBtn = menuItemElement?.querySelector('.quantity-btn');
                
                if (menuItemElement) {
                    if (quantity > 0) {
                        menuItemElement.classList.add('selected');
                    } else {
                        menuItemElement.classList.remove('selected');
                    }
                }
                
                if (quantityDisplay) {
                    quantityDisplay.textContent = quantity;
                }
                
                if (decreaseBtn) {
                    if (quantity === 0) {
                        decreaseBtn.style.opacity = '0.5';
                        decreaseBtn.style.cursor = 'not-allowed';
                    } else {
                        decreaseBtn.style.opacity = '1';
                        decreaseBtn.style.cursor = 'pointer';
                    }
                }
            });

            // Update quantity di modal jika modal sedang terbuka
            updateModalQuantity();
        }
        
        /**
         * Menghapus item dari pesanan
         * @param {string} itemId - ID item menu yang akan dihapus
         */
        function removeItem(itemId) {
            if (selectedMenu[itemId]) {
                delete selectedMenu[itemId];
                updateMenuDisplay();
                updateSelectedItemsSummary();
                updateLocationMenuDisplay();
                updateTotalPayment();
                showToast('Item berhasil dihapus dari pesanan', 'success');
            }
        }

        // ============================================
        // FUNGSI MODAL DETAIL MAKANAN
        // ============================================

        /**
         * Menampilkan modal detail makanan
         * @param {string} itemId - ID item menu yang akan ditampilkan
         */
        function showFoodDetail(itemId) {
            const item = menuData.foods.find(food => food.id === itemId);
            if (!item) return;

            currentModalItemId = itemId;
            const modal = document.getElementById('foodDetailModal');
            const imageContainer = document.getElementById('foodDetailImage');
            const nameElement = document.getElementById('foodDetailName');
            const priceElement = document.getElementById('foodDetailPrice');
            const descriptionElement = document.getElementById('foodDetailDescription');
            const quantityElement = document.getElementById('foodDetailQuantity');
            const decreaseBtn = document.getElementById('foodDetailDecrease');
            const increaseBtn = document.getElementById('foodDetailIncrease');

            // Set nama
            nameElement.textContent = item.name;

            // Set harga
            priceElement.textContent = `Rp ${item.price.toLocaleString('id-ID')}`;

            // Set gambar
            if (item.image) {
                imageContainer.innerHTML = `<img src="${item.image}" alt="${item.name}" onerror="this.parentElement.innerHTML='<div class=\\'image-placeholder\\'>üçΩÔ∏è</div>'">`;
            } else {
                imageContainer.innerHTML = '<div class="image-placeholder">üçΩÔ∏è</div>';
            }

            // Set deskripsi
            if (item.description && item.description.length > 0) {
                descriptionElement.innerHTML = `
                    <div class="food-detail-description-label">
                        <i class="fas fa-list"></i>
                        <span>Isi Makanan:</span>
                    </div>
                    <ul class="food-detail-description-list">
                        ${item.description.map(desc => `<li>${desc}</li>`).join('')}
                    </ul>
                `;
            } else {
                descriptionElement.innerHTML = '<p style="color: var(--text-secondary);">Tidak ada deskripsi tersedia.</p>';
            }

            // Set quantity
            const quantity = selectedMenu[itemId]?.quantity || 0;
            quantityElement.textContent = quantity;
            updateModalQuantityButtons(quantity, decreaseBtn, increaseBtn);

            // Tampilkan modal
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scroll
        }

        /**
         * Menutup modal detail makanan
         */
        function closeFoodDetail() {
            const modal = document.getElementById('foodDetailModal');
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Restore scroll
            currentModalItemId = null;
        }

        /**
         * Update tombol quantity di modal
         */
        function updateModalQuantityButtons(quantity, decreaseBtn, increaseBtn) {
            if (quantity === 0) {
                decreaseBtn.disabled = true;
            } else {
                decreaseBtn.disabled = false;
            }
        }

        /**
         * Meningkatkan quantity dari modal
         */
        function increaseQuantityFromModal() {
            if (!currentModalItemId) return;
            increaseQuantity(currentModalItemId);
            const quantity = selectedMenu[currentModalItemId]?.quantity || 0;
            document.getElementById('foodDetailQuantity').textContent = quantity;
            const decreaseBtn = document.getElementById('foodDetailDecrease');
            const increaseBtn = document.getElementById('foodDetailIncrease');
            updateModalQuantityButtons(quantity, decreaseBtn, increaseBtn);
        }

        /**
         * Mengurangi quantity dari modal
         */
        function decreaseQuantityFromModal() {
            if (!currentModalItemId) return;
            decreaseQuantity(currentModalItemId);
            const quantity = selectedMenu[currentModalItemId]?.quantity || 0;
            document.getElementById('foodDetailQuantity').textContent = quantity;
            const decreaseBtn = document.getElementById('foodDetailDecrease');
            const increaseBtn = document.getElementById('foodDetailIncrease');
            updateModalQuantityButtons(quantity, decreaseBtn, increaseBtn);
        }

        /**
         * Update quantity di modal jika ada perubahan dari luar modal
         */
        function updateModalQuantity() {
            if (currentModalItemId) {
                const quantity = selectedMenu[currentModalItemId]?.quantity || 0;
                const quantityElement = document.getElementById('foodDetailQuantity');
                if (quantityElement) {
                    quantityElement.textContent = quantity;
                }
                const decreaseBtn = document.getElementById('foodDetailDecrease');
                const increaseBtn = document.getElementById('foodDetailIncrease');
                if (decreaseBtn && increaseBtn) {
                    updateModalQuantityButtons(quantity, decreaseBtn, increaseBtn);
                }
            }
        }
        
        /**
         * Update summary pesanan yang dipilih
         */
        function updateSelectedItemsSummary() {
            const summarySection = document.getElementById('selectedItemsSummary');
            const itemsList = document.getElementById('selectedItemsList');
            const totalPriceElement = document.getElementById('totalPrice');
            
            // Hitung total item yang dipilih
            const totalItems = Object.values(selectedMenu).reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalItems === 0) {
                // Sembunyikan summary jika tidak ada item yang dipilih
                summarySection.style.display = 'none';
                return;
            }
            
            // Tampilkan summary
            summarySection.style.display = 'block';
            
            // Render daftar item yang dipilih
            itemsList.innerHTML = '';
            let totalPrice = 0;
            
            const allItems = [...menuData.foods];
            allItems.forEach(item => {
                const quantity = selectedMenu[item.id]?.quantity || 0;
                if (quantity > 0) {
                    const itemTotal = item.price * quantity;
                    totalPrice += itemTotal;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'selected-item';
                    itemElement.innerHTML = `
                        <div class="selected-item-name">${item.name}</div>
                        <div class="selected-item-details">
                            <span class="selected-item-quantity">${quantity}x</span>
                            <span class="selected-item-price">Rp ${itemTotal.toLocaleString('id-ID')}</span>
                            <button class="remove-item-btn" onclick="removeItem('${item.id}')" title="Hapus item">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    itemsList.appendChild(itemElement);
                }
            });
            
            // Update total harga
            totalPriceElement.textContent = `Rp ${totalPrice.toLocaleString('id-ID')}`;
        }
        
        /**
         * Update tampilan menu di location section
         */
        function updateLocationMenuDisplay() {
            const locationMenuSummary = document.getElementById('locationMenuSummary');
            const locationMenuList = document.getElementById('locationMenuList');
            const locationMenuTotal = document.getElementById('locationMenuTotal');
            
            // Hitung total item yang dipilih
            const totalItems = Object.values(selectedMenu).reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalItems === 0) {
                // Sembunyikan summary jika tidak ada item yang dipilih
                locationMenuSummary.style.display = 'none';
                return;
            }
            
            // Tampilkan summary
            locationMenuSummary.style.display = 'block';
            
            // Render daftar item yang dipilih
            locationMenuList.innerHTML = '';
            let totalPrice = 0;
            
            const allItems = [...menuData.foods];
            allItems.forEach(item => {
                const quantity = selectedMenu[item.id]?.quantity || 0;
                if (quantity > 0) {
                    const itemTotal = item.price * quantity;
                    totalPrice += itemTotal;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'menu-summary-item';
                    itemElement.innerHTML = `
                        <div class="menu-summary-name">${item.name}</div>
                        <div class="menu-summary-details">
                            <span>${quantity}x √ó Rp ${item.price.toLocaleString('id-ID')}</span>
                            <span style="color: var(--primary-color); font-weight: 600;">Rp ${itemTotal.toLocaleString('id-ID')}</span>
                        </div>
                    `;
                    locationMenuList.appendChild(itemElement);
                }
            });
            
            // Update total harga
            locationMenuTotal.textContent = `Rp ${totalPrice.toLocaleString('id-ID')}`;
            
            // Update total pembayaran jika ongkir sudah dihitung
            updateTotalPayment();
        }
        
        /**
         * Update total pembayaran (menu + ongkir)
         */
        function updateTotalPayment() {
            const totalPaymentItem = document.getElementById('totalPaymentItem');
            const totalPayment = document.getElementById('totalPayment');
            const ongkirText = document.getElementById('ongkir').textContent;
            
            // Hitung total menu
            const allItems = [...menuData.foods];
            let totalMenuPrice = 0;
            allItems.forEach(item => {
                const quantity = selectedMenu[item.id]?.quantity || 0;
                if (quantity > 0) {
                    totalMenuPrice += item.price * quantity;
                }
            });
            
            // Parse ongkir dari text (format: "Rp 15.000", "Gratis", atau "-")
            let ongkir = 0;
            if (ongkirText !== '-' && ongkirText !== 'Menghitung...') {
                if (ongkirText.toLowerCase().includes('gratis')) {
                    ongkir = 0;
                } else {
                    const ongkirMatch = ongkirText.match(/[\d.]+/);
                    if (ongkirMatch) {
                        ongkir = parseInt(ongkirMatch[0].replace(/\./g, ''));
                    }
                }
            }
            
            // Tampilkan total pembayaran jika ongkir sudah dihitung (termasuk jika gratis)
            if (ongkirText !== '-' && ongkirText !== 'Menghitung...') {
                const total = totalMenuPrice + ongkir;
                totalPayment.textContent = `Rp ${total.toLocaleString('id-ID')}`;
                totalPaymentItem.style.display = 'flex';
            } else {
                totalPaymentItem.style.display = 'none';
            }
        }
        
        /**
         * Proceed ke section lokasi setelah memilih menu
         */
        function proceedToLocation() {
            const totalItems = Object.values(selectedMenu).reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalItems === 0) {
                showToast('Silakan pilih menu terlebih dahulu!', 'error');
                return;
            }
            
            // Sembunyikan menu section
            document.getElementById('menuSection').style.display = 'none';
            
            // Tampilkan location section
            document.getElementById('locationSection').style.display = 'block';
            
            // Update tampilan menu di location section
            updateLocationMenuDisplay();
            
            // Scroll ke location section
            document.getElementById('locationSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            showToast('Silakan pilih lokasi pengiriman Anda', 'success');
        }
        
        /**
         * Kembali ke menu section untuk mengubah pesanan
         */
        function backToMenu() {
            // Sembunyikan location section
            document.getElementById('locationSection').style.display = 'none';
            
            // Tampilkan menu section
            document.getElementById('menuSection').style.display = 'block';
            
            // Scroll ke menu section
            document.getElementById('menuSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ============================================
        // FUNGSI UTILITAS - TOAST NOTIFICATION
        // ============================================
        
        /**
         * Menampilkan notifikasi toast (popup notification)
         * @param {string} message - Pesan yang akan ditampilkan
         * @param {string} type - Tipe notifikasi: 'info', 'success', atau 'error'
         */
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            const bgColor = type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info';
            
            const toastHTML = `
                <div id="${toastId}" class="toast align-items-center text-white bg-${bgColor} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">${message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
            toast.show();
            
            // Hapus elemen toast dari DOM setelah animasi selesai
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // ============================================
        // FUNGSI INISIALISASI PETA
        // ============================================
        
        /**
         * Menginisialisasi peta Leaflet dan menambahkan marker restoran
         * Fungsi ini dipanggil saat halaman pertama kali dimuat
         */
        function initMap() {
            // Inisialisasi peta dengan koordinat restoran dan zoom level 15
            map = L.map('map').setView([restoLatLng.lat, restoLatLng.lng], 15);
            
            // Menambahkan tile layer dari OpenStreetMap sebagai background peta
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19  // Maksimal zoom level
            }).addTo(map);

            // Membuat custom icon untuk marker restoran dengan garis vertikal di bawahnya
            const restoIcon = L.divIcon({
                className: 'custom-marker',
                html: `
                    <div style="position: relative; width: 40px; height: 50px;">
                        <div style="background-color: #00e6e6; width: 35px; height: 35px; border-radius: 50%; border: 4px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.4); position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: 2;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px;">üìç</div>
                        </div>
                        <div style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 3px; height: 20px; background: linear-gradient(180deg, #00e6e6 0%, rgba(0, 230, 230, 0.3) 100%); border-radius: 2px; z-index: 1;"></div>
                    </div>
                `,
                iconSize: [40, 50],
                iconAnchor: [20, 50]
            });

            // Menambahkan marker restoran ke peta dengan popup informasi
            restoMarker = L.marker(restoLatLng, { icon: restoIcon })
                .addTo(map)
                .bindPopup("<strong>üìç Restoran</strong><br>Lokasi pengiriman dimulai dari sini");

            // Menambahkan event listener untuk klik pada peta
            // Ketika user klik peta, lokasi pelanggan akan diupdate
            map.on('click', function(e) {
                updateCustomerLocation(e.latlng);
            });
        }

        // ============================================
        // FUNGSI GEOLOCATION - MENDAPATKAN LOKASI USER
        // ============================================
        
        /**
         * Menggunakan Geolocation API browser untuk mendapatkan lokasi user saat ini
         * Fungsi ini dipanggil ketika user klik tombol "Gunakan Lokasi Saya"
         */
        function setLocationByGeolocation() {
            // Simpan referensi button dan teks aslinya untuk restore nanti
            const button = event.target;
            const originalText = button.innerHTML;
            
            // Cek apakah browser mendukung Geolocation API
            if (!navigator.geolocation) {
                showToast("Geolocation tidak didukung oleh browser Anda.", 'error');
                return;
            }

            // Disable button dan tampilkan loading spinner
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Mencari lokasi...';

            // Request lokasi user dengan opsi high accuracy
            navigator.geolocation.getCurrentPosition(
                // Callback sukses: lokasi berhasil didapatkan
                (position) => {
                    // Ambil koordinat dari position object
                    const customerLatLng = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    // Update lokasi pelanggan di peta
                    updateCustomerLocation(customerLatLng);
                    // Restore button ke kondisi semula
                    button.disabled = false;
                    button.innerHTML = originalText;
                    showToast("Lokasi berhasil ditemukan!", 'success');
                },
                // Callback error: gagal mendapatkan lokasi
                (error) => {
                    // Restore button ke kondisi semula
                    button.disabled = false;
                    button.innerHTML = originalText;
                    // Tentukan pesan error berdasarkan error code
                    let errorMessage = "Gagal mendapatkan lokasi.";
                    if (error.code === 1) {
                        // User menolak akses lokasi
                        errorMessage = "Akses lokasi ditolak. Silakan izinkan akses lokasi di pengaturan browser.";
                    } else if (error.code === 2) {
                        // Lokasi tidak dapat ditentukan
                        errorMessage = "Lokasi tidak dapat ditentukan.";
                    } else if (error.code === 3) {
                        // Timeout
                        errorMessage = "Waktu permintaan lokasi habis.";
                    }
                    showToast(errorMessage, 'error');
                },
                // Opsi untuk geolocation
                {
                    enableHighAccuracy: true,  // Gunakan GPS jika tersedia untuk akurasi lebih tinggi
                    timeout: 10000,             // Timeout 10 detik
                    maximumAge: 0               // Jangan gunakan cache, selalu request lokasi baru
                }
            );
        }

        // ============================================
        // FUNGSI UPDATE LOKASI PELANGGAN
        // ============================================
        
        /**
         * Memperbarui lokasi pelanggan di peta dan menghitung rute
         * @param {Object} latLng - Objek dengan property lat dan lng
         */
        function updateCustomerLocation(latLng) {
            // Reset dropdown dan section saat lokasi berubah
            document.getElementById("noteSection").style.display = "none";
            document.getElementById("whatsappButton").style.display = "none";
            document.getElementById("lokasiDropdown").style.display = "none";
            document.getElementById("ongkir").innerText = "-";
            document.getElementById("customer_name").value = "";
            document.getElementById("customer_note").value = "";
            
            // Validasi koordinat: pastikan dalam range yang valid
            // Latitude harus antara -90 sampai 90, Longitude harus antara -180 sampai 180
            if (latLng.lat < -90 || latLng.lat > 90 || latLng.lng < -180 || latLng.lng > 180) {
                showToast("Koordinat tidak valid.", 'error');
                return;
            }

            // Membuat custom icon untuk marker pelanggan dengan garis vertikal di bawahnya
            const customerIcon = L.divIcon({
                className: 'custom-marker',
                html: `
                    <div style="position: relative; width: 40px; height: 50px;">
                        <div style="background-color: #4caf50; width: 35px; height: 35px; border-radius: 50%; border: 4px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.4); position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: 2;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px;">üìç</div>
                        </div>
                        <div style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 3px; height: 20px; background: linear-gradient(180deg, #4caf50 0%, rgba(76, 175, 80, 0.3) 100%); border-radius: 2px; z-index: 1;"></div>
                    </div>
                `,
                iconSize: [40, 50],
                iconAnchor: [20, 50]
            });

            // Jika marker sudah ada, update posisi dan icon
            // Jika belum ada, buat marker baru
            if (customerMarker) {
                customerMarker.setLatLng(latLng);
                customerMarker.setIcon(customerIcon);
            } else {
                // Buat marker baru untuk pelanggan
                customerMarker = L.marker(latLng, { icon: customerIcon })
                    .addTo(map)
                    .bindPopup("<strong>üìç Lokasi Anda</strong>");
            }

            // Update nilai input koordinat dengan format 6 desimal
            document.getElementById("customer_coordinates").value = `${latLng.lat.toFixed(6)}, ${latLng.lng.toFixed(6)}`;
            
            // Hitung jarak langsung untuk menentukan zoom level yang tepat
            const directDistance = calculateDistance(restoLatLng.lat, restoLatLng.lng, latLng.lat, latLng.lng);
            
            // Sesuaikan view peta agar kedua marker (restoran dan pelanggan) terlihat
            // Gunakan setTimeout untuk memastikan marker sudah benar-benar ditambahkan ke map
            setTimeout(() => {
                const group = new L.featureGroup([restoMarker, customerMarker]);
                const bounds = group.getBounds();
                const center = bounds.getCenter();
                
                // Tentukan zoom level berdasarkan jarak - semakin dekat semakin tinggi zoom
                let zoomLevel;
                if (directDistance < 0.5) {
                    // Jarak sangat dekat (< 500m), zoom sangat dekat
                    zoomLevel = 16;
                } else if (directDistance < 1) {
                    // Jarak dekat (< 1 km), zoom dekat
                    zoomLevel = 15;
                } else if (directDistance < 3) {
                    // Jarak sedang (1-3 km), zoom sedang-dekat
                    zoomLevel = 14;
                } else if (directDistance < 5) {
                    // Jarak agak jauh (3-5 km), zoom sedang
                    zoomLevel = 13;
                } else {
                    // Jarak jauh (> 5 km), zoom agak jauh tapi tetap terlihat jelas
                    zoomLevel = 12;
                }
                
                // Gunakan setView dengan zoom level yang sudah ditentukan
                // Ini akan zoom in lebih dekat dibanding fitBounds
                map.setView(center, zoomLevel);
                
                // Jika jarak terlalu jauh, gunakan fitBounds dengan padding minimal
                if (directDistance > 10) {
                    map.fitBounds(bounds.pad(0.1), {
                        padding: [30, 30]
                    });
                }
            }, 100);
            
            // Hitung dan tampilkan rute dari restoran ke lokasi pelanggan
            getRoute(restoLatLng, latLng);
        }

        // ============================================
        // FUNGSI HANDLE INPUT KOORDINAT MANUAL
        // ============================================
        
        /**
         * Menangani input koordinat manual dari user
         * Dipanggil ketika user menekan Enter di input koordinat
         * @param {Event} event - Event object dari keyboard
         */
        function handleCoordinateInput(event) {
            // Hanya proses jika user menekan tombol Enter
            if (event.key === 'Enter') {
                const input = document.getElementById("customer_coordinates");
                // Parse string koordinat menjadi object {lat, lng}
                const coords = parseCoordinates(input.value);
                if (coords) {
                    // Jika parsing berhasil, update lokasi pelanggan
                    updateCustomerLocation(coords);
                } else {
                    // Jika parsing gagal, tampilkan error
                    showToast("Format koordinat tidak valid. Gunakan format: lat, lng", 'error');
                }
            }
        }

        /**
         * Mengkonversi string koordinat menjadi object {lat, lng}
         * Format input: "latitude, longitude" (contoh: "-6.251627, 107.246045")
         * @param {string} str - String koordinat yang akan di-parse
         * @returns {Object|null} - Object dengan property lat dan lng, atau null jika invalid
         */
        function parseCoordinates(str) {
            // Cek jika string kosong atau null
            if (!str || str.trim() === '') return null;
            
            // Split string berdasarkan koma dan convert ke float
            const coords = str.split(',').map(s => parseFloat(s.trim()));
            
            // Validasi: harus ada 2 koordinat dan keduanya adalah angka valid
            if (coords.length === 2 && !isNaN(coords[0]) && !isNaN(coords[1])) {
                return {
                    lat: coords[0],  // Latitude
                    lng: coords[1]   // Longitude
                };
            }
            return null;
        }

        // ============================================
        // FUNGSI PERHITUNGAN JARAK
        // ============================================
        
        /**
         * Menghitung jarak antara dua titik koordinat menggunakan formula Haversine
         * Formula ini menghitung jarak lingkaran besar (great circle distance) di permukaan bumi
         * @param {number} lat1 - Latitude titik pertama
         * @param {number} lon1 - Longitude titik pertama
         * @param {number} lat2 - Latitude titik kedua
         * @param {number} lon2 - Longitude titik kedua
         * @returns {number} - Jarak dalam kilometer
         */
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius bumi dalam kilometer
            
            // Konversi selisih latitude dan longitude ke radian
            const dLat = (lat2 - lat1) * (Math.PI / 180);
            const dLon = (lon2 - lon1) * (Math.PI / 180);
            
            // Formula Haversine untuk menghitung jarak
            const a = Math.sin(dLat / 2) ** 2 +
                Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                Math.sin(dLon / 2) ** 2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            
            // Jarak = radius bumi * sudut sentral (c)
            return R * c;
        }

        /**
         * Daftar desa yang mendapat ongkir berdasarkan jarak
         */
        const desaBerbayar = [
            'bojongsari',
            'karangharum',
            'karangmekar',
            'karangsambung',
            'kedungwaringin',
            'waringinjaya'
        ];

        /**
         * Mengecek jenis lokasi menggunakan reverse geocoding
         * @param {number} lat - Latitude lokasi
         * @param {number} lng - Longitude lokasi
         * @returns {Promise<Object>} - {type: "mekarjaya"|"desa_berbayar"|"luar", desa: string|null}
         */
        async function checkLocationType(lat, lng) {
            try {
                // Gunakan Nominatim reverse geocoding API (gratis)
                const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1`;
                
                const response = await fetch(url, {
                    headers: {
                        'User-Agent': 'Sistem-DO-Makanan/1.0'
                    }
                });
                
                if (!response.ok) {
                    console.error('Reverse geocoding failed');
                    return {type: 'luar', desa: null};
                }
                
                const data = await response.json();
                
                // Cek di berbagai field alamat
                const address = JSON.stringify(data.address || {}).toLowerCase();
                const displayName = (data.display_name || '').toLowerCase();
                const village = (data.address?.village || '').toLowerCase();
                const suburb = (data.address?.suburb || '').toLowerCase();
                const hamlet = (data.address?.hamlet || '').toLowerCase();
                
                // Cek apakah di Mekarjaya (gratis)
                if (address.includes('mekarjaya') || displayName.includes('mekarjaya') ||
                    village.includes('mekarjaya') || suburb.includes('mekarjaya') || 
                    hamlet.includes('mekarjaya')) {
                    return {type: 'mekarjaya', desa: 'mekarjaya'};
                }
                
                // Cek apakah di salah satu desa berbayar dan return nama desa spesifik
                for (const desa of desaBerbayar) {
                    if (address.includes(desa) || displayName.includes(desa) ||
                        village.includes(desa) || suburb.includes(desa) || 
                        hamlet.includes(desa)) {
                        return {type: 'desa_berbayar', desa: desa};
                    }
                }
                
                return {type: 'luar', desa: null};
            } catch (error) {
                console.error('Error checking location:', error);
                // Jika error, default ke luar
                return {type: 'luar', desa: null};
            }
        }

        /**
         * Menghitung ongkos kirim berdasarkan jarak untuk desa berbayar
         * @param {number} distance - Jarak dalam kilometer
         * @returns {number} - Ongkos kirim dalam rupiah
         */
        function calculateOngkirByDistance(distance) {
            if (distance <= 2) {
                // Jarak <= 2 km: ongkir 3000
                return 3000;
            } else if (distance <= 4) {
                // Jarak > 2 km dan <= 4 km: ongkir 3000-5000 (random atau bisa 4000)
                return Math.floor(Math.random() * (5000 - 3000 + 1)) + 3000;
            } else {
                // Jarak > 4 km: ongkir 5000 atau lebih
                // Untuk jarak > 4 km, tambahkan 500 per km tambahan
                const tambahanKm = Math.ceil(distance - 4);
                return 5000 + (tambahanKm * 500);
            }
        }

        /**
         * Menghitung total jarak dari array koordinat rute
         * Menjumlahkan jarak antara setiap titik berurutan dalam rute
         * @param {Array} coordinates - Array koordinat [[lat, lng], [lat, lng], ...]
         * @returns {number} - Total jarak dalam kilometer
         */
        function calculateRouteDistance(coordinates) {
            let totalDistance = 0;
            // Loop melalui setiap pasangan koordinat berurutan
            for (let i = 0; i < coordinates.length - 1; i++) {
                const lat1 = coordinates[i][0];      // Latitude titik saat ini
                const lng1 = coordinates[i][1];      // Longitude titik saat ini
                const lat2 = coordinates[i + 1][0];  // Latitude titik berikutnya
                const lng2 = coordinates[i + 1][1];  // Longitude titik berikutnya
                // Tambahkan jarak antara dua titik ke total
                totalDistance += calculateDistance(lat1, lng1, lat2, lng2);
            }
            return totalDistance;
        }

        // ============================================
        // FUNGSI UPDATE INFORMASI JARAK DAN ONGKIR
        // ============================================
        
        /**
         * Memperbarui tampilan informasi jarak, ongkir, dan tombol WhatsApp
         * @param {Object} customerLatLng - Koordinat lokasi pelanggan
         * @param {number} routeDistance - Jarak rute dalam kilometer
         */
        function updateInfo(customerLatLng, routeDistance) {
            const distance = routeDistance || 0;
            
            // Format jarak untuk ditampilkan: jika < 1 km tampilkan dalam meter, jika >= 1 km tampilkan dalam km
            let distanceText = "Menghitung...";
            if (distance > 0) {
                if (distance < 1) {
                    // Jika jarak kurang dari 1 km, konversi ke meter dan bulatkan
                    const distanceInMeters = Math.round(distance * 1000);
                    distanceText = distanceInMeters + " m";
                } else {
                    // Jika jarak >= 1 km, tampilkan dengan 2 desimal
                    distanceText = distance.toFixed(2) + " km";
                }
            }
            
            // Update tampilan jarak di UI
            document.getElementById("jarak").innerText = distanceText;

            // Jika jarak valid, lanjutkan proses
            if (distance > 0) {
                // Tampilkan loading untuk ongkir
                document.getElementById("ongkir").innerText = "Menghitung...";
                
                // Cek jenis lokasi (async)
                checkLocationType(customerLatLng.lat, customerLatLng.lng)
                    .then(locationInfo => {
                        // Tampilkan section untuk input catatan/note
                        document.getElementById("noteSection").style.display = "block";
                        
                        // Tampilkan dropdown lokasi
                        const lokasiDropdown = document.getElementById("lokasiDropdown");
                        lokasiDropdown.style.display = "block";
                        
                        let initialOngkir = 0;
                        
                        // Set default value berdasarkan deteksi lokasi
                        const lokasiSelect = document.getElementById("lokasi_select");
                        
                        if (locationInfo.type === 'mekarjaya') {
                            lokasiSelect.value = "mekarjaya";
                            document.getElementById("ongkir").innerText = "Gratis";
                            initialOngkir = 0;
                        } else if (locationInfo.type === 'desa_berbayar' && locationInfo.desa) {
                            // Untuk desa berbayar, set dropdown ke desa yang terdeteksi
                            lokasiSelect.value = locationInfo.desa;
                            // Hitung ongkir berdasarkan jarak
                            initialOngkir = calculateOngkirByDistance(distance);
                            document.getElementById("ongkir").innerText = `Rp ${initialOngkir.toLocaleString("id-ID")}`;
                        } else {
                            // Lokasi tidak terdeteksi, biarkan user memilih sendiri
                            lokasiSelect.value = "";
                            document.getElementById("ongkir").innerText = "-";
                            initialOngkir = 0;
                        }
                        
                        // Setup event handler untuk dropdown lokasi
                        setupLokasiDropdown(customerLatLng, distance);

                        // Update total pembayaran (menu + ongkir)
                        updateTotalPayment();

                        // Tampilkan tombol WhatsApp dan setup event handler dengan ongkir awal
                        const whatsappButton = document.getElementById("whatsappButton");
                        whatsappButton.style.display = "block";
                        setupWhatsAppButton(customerLatLng, distance, initialOngkir);
                    })
                    .catch(error => {
                        console.error('Error checking location:', error);
                        // Jika error, tampilkan dropdown dan biarkan user memilih
                        document.getElementById("noteSection").style.display = "block";
                        const lokasiDropdown = document.getElementById("lokasiDropdown");
                        lokasiDropdown.style.display = "block";
                        const lokasiSelect = document.getElementById("lokasi_select");
                        // Biarkan dropdown kosong, user harus memilih sendiri
                        lokasiSelect.value = "";
                        document.getElementById("ongkir").innerText = "-";
                        setupLokasiDropdown(customerLatLng, distance);
                        updateTotalPayment();
                        const whatsappButton = document.getElementById("whatsappButton");
                        whatsappButton.style.display = "block";
                        // Setup dengan ongkir 0 dulu, akan diupdate saat user pilih lokasi
                        setupWhatsAppButton(customerLatLng, distance, 0);
                    });
            }
        }

        /**
         * Setup event handler untuk dropdown lokasi
         * @param {Object} customerLatLng - Koordinat lokasi pelanggan
         * @param {number} distance - Jarak dalam kilometer
         */
        function setupLokasiDropdown(customerLatLng, distance) {
            const lokasiSelect = document.getElementById("lokasi_select");
            
            // Daftar desa berbayar
            const desaBerbayarList = ['bojongsari', 'karangharum', 'karangmekar', 'karangsambung', 'kedungwaringin', 'waringinjaya'];
            
            // Event handler untuk dropdown lokasi
            lokasiSelect.onchange = () => {
                const selectedLokasi = lokasiSelect.value;
                let selectedOngkir = 0;
                
                // Reset border jika sebelumnya ada error
                lokasiSelect.style.borderColor = '';
                
                if (!selectedLokasi || selectedLokasi === "") {
                    // Jika belum dipilih, reset ongkir
                    document.getElementById("ongkir").innerText = "-";
                    updateTotalPayment();
                    return;
                }
                
                if (selectedLokasi === "mekarjaya") {
                    // Gratis untuk Mekarjaya
                    selectedOngkir = 0;
                    document.getElementById("ongkir").innerText = "Gratis";
                } else if (desaBerbayarList.includes(selectedLokasi)) {
                    // Untuk desa berbayar, hitung ongkir berdasarkan jarak
                    selectedOngkir = calculateOngkirByDistance(distance);
                    document.getElementById("ongkir").innerText = `Rp ${selectedOngkir.toLocaleString("id-ID")}`;
                }
                
                updateTotalPayment();
                
                // Update WhatsApp button dengan ongkir baru
                const whatsappButton = document.getElementById("whatsappButton");
                if (whatsappButton.style.display !== "none") {
                    setupWhatsAppButton(customerLatLng, distance, selectedOngkir);
                }
            };
        }

        /**
         * Setup event handler untuk tombol WhatsApp
         * @param {Object} customerLatLng - Koordinat lokasi pelanggan
         * @param {number} distance - Jarak dalam kilometer
         * @param {number} ongkir - Ongkos kirim yang sudah dihitung
         */
        function setupWhatsAppButton(customerLatLng, distance, ongkir) {
            const whatsappButton = document.getElementById("whatsappButton");
            
            // Hapus event listener lama jika ada
            whatsappButton.onclick = null;
            
            // Event handler untuk tombol kirim ke WhatsApp
            whatsappButton.onclick = () => {
                // Validasi: pastikan lokasi sudah dipilih
                const lokasiSelect = document.getElementById("lokasi_select");
                const selectedLokasi = lokasiSelect.value;
                
                if (!selectedLokasi || selectedLokasi === "") {
                    showToast("Silakan pilih lokasi terlebih dahulu!", 'error');
                    // Scroll ke dropdown lokasi
                    lokasiSelect.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    lokasiSelect.focus();
                    // Tambahkan border merah untuk menunjukkan error
                    lokasiSelect.style.borderColor = '#dc3545';
                    setTimeout(() => {
                        lokasiSelect.style.borderColor = '';
                    }, 3000);
                    return;
                }
                
                // Validasi: pastikan nama pembeli sudah diisi
                const customerNameInput = document.getElementById("customer_name");
                const customerName = customerNameInput.value.trim();
                
                if (!customerName || customerName === "") {
                    showToast("Silakan isi nama pembeli terlebih dahulu!", 'error');
                    // Scroll ke input nama pembeli
                    customerNameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    customerNameInput.focus();
                    // Tambahkan border merah untuk menunjukkan error
                    customerNameInput.style.borderColor = '#dc3545';
                    setTimeout(() => {
                        customerNameInput.style.borderColor = '';
                    }, 3000);
                    return;
                }
                
                // Format jarak untuk ditampilkan di pesan WhatsApp
                let distanceForMessage = "";
                if (distance < 1) {
                    // Jika < 1 km, tampilkan dalam meter
                    const distanceInMeters = Math.round(distance * 1000);
                    distanceForMessage = distanceInMeters + " m";
                } else {
                    // Jika >= 1 km, tampilkan dalam kilometer dengan 2 desimal
                    distanceForMessage = distance.toFixed(2) + " km";
                }
                
                // Ambil catatan/request khusus dari input textarea
                const customerNote = document.getElementById("customer_note").value.trim();
                
                // Buat link Google Maps untuk share location pelanggan
                // Link ini akan membuka Google Maps dengan pin di lokasi pelanggan
                const googleMapsLink = `https://www.google.com/maps?q=${customerLatLng.lat},${customerLatLng.lng}`;
                
                // Buat template pesan WhatsApp dengan informasi lengkap
                let pesanWA = `Halo, saya ingin memesan makanan.\n\n`;
                
                // Tambahkan nama pembeli (wajib)
                pesanWA += `üë§ *Nama Pembeli:* ${customerName}\n\n`;
                
                // Tambahkan detail menu yang dipilih
                const allItems = [...menuData.foods];
                let menuItems = [];
                let totalMenuPrice = 0;
                
                allItems.forEach(item => {
                    const quantity = selectedMenu[item.id]?.quantity || 0;
                    if (quantity > 0) {
                        const itemTotal = item.price * quantity;
                        totalMenuPrice += itemTotal;
                        menuItems.push(`${item.name} x${quantity} = Rp ${itemTotal.toLocaleString('id-ID')}`);
                    }
                });
                
                if (menuItems.length > 0) {
                    pesanWA += `üçΩÔ∏è *Pesanan Saya:*\n${menuItems.join('\n')}\n`;
                    pesanWA += `\nüí∞ *Subtotal Menu:* Rp ${totalMenuPrice.toLocaleString('id-ID')}\n`;
                }
                
                // Format ongkir untuk pesan
                let ongkirMessage = "";
                if (ongkir === 0) {
                    ongkirMessage = "Gratis";
                } else {
                    ongkirMessage = `Rp ${ongkir.toLocaleString("id-ID")}`;
                }
                
                pesanWA += `\nüìç *Lokasi Saya:*\n${googleMapsLink}\n\nKoordinat:\nLatitude: ${customerLatLng.lat.toFixed(6)}\nLongitude: ${customerLatLng.lng.toFixed(6)}\n\nüìè Jarak: ${distanceForMessage}\nüí∞ Ongkir: ${ongkirMessage}`;
                
                // Hitung total keseluruhan
                const totalAll = totalMenuPrice + ongkir;
                pesanWA += `\n\nüíµ *Total Pembayaran:* Rp ${totalAll.toLocaleString('id-ID')}`;
                
                // Tambahkan catatan/request jika user mengisi field note
                if (customerNote) {
                    pesanWA += `\n\nüìù *Catatan:*\n${customerNote}`;
                }
                
                // Tambahkan instruksi untuk membuka Google Maps
                pesanWA += `\n\nKlik link di atas untuk melihat lokasi di Google Maps.\n\nTerima kasih!`;
                
                // WA Testing Desi
                // Encode pesan untuk URL dan buka WhatsApp dengan pesan yang sudah disiapkan
                // const linkWA = `https://wa.me/6285882900757?text=${encodeURIComponent(pesanWA)}`;

                // WA Testing raihan
                const linkWA = `https://wa.me/6285157204233?text=${encodeURIComponent(pesanWA)}`;
                window.open(linkWA, "_blank");  // Buka di tab baru
            };
        }

        // ============================================
        // FUNGSI DECODE POLYLINE
        // ============================================
        
        /**
         * Mendekode encoded polyline string menjadi array koordinat
         * Polyline adalah format kompresi untuk menyimpan rute jalan
         * Mendukung format standard (precision 5) dan polyline6 (precision 6)
         * @param {string} encoded - String polyline yang ter-encode
         * @param {number} precision - Presisi koordinat (5 untuk standard, 6 untuk polyline6)
         * @returns {Array} - Array koordinat [[lat, lng], [lat, lng], ...]
         */
        function decodePolyline(encoded, precision = 5) {
            // Validasi input: pastikan encoded adalah string yang valid
            if (!encoded || typeof encoded !== 'string') {
                console.error('Invalid polyline string');
                return [];
            }
            
            const poly = [];           // Array untuk menyimpan hasil koordinat
            let index = 0;             // Index untuk iterasi string
            const len = encoded.length; // Panjang string
            let lat = 0;                // Akumulator latitude (delta encoding)
            let lng = 0;                // Akumulator longitude (delta encoding)
            const factor = Math.pow(10, precision);  // Faktor untuk konversi presisi

            try {
                // Loop melalui setiap karakter dalam encoded string
                while (index < len) {
                    let b;
                    let shift = 0;
                    let result = 0;
                    
                    // Decode latitude (delta encoding)
                    do {
                        if (index >= len) break;
                        b = encoded.charCodeAt(index++) - 63;  // Offset 63 untuk encoding
                        result |= (b & 0x1f) << shift;        // Ambil 5 bit dan shift
                        shift += 5;
                    } while (b >= 0x20);  // Lanjut jika bit continuation masih aktif
                    
                    // Decode delta latitude (two's complement)
                    const dlat = ((result & 1) !== 0 ? ~(result >> 1) : (result >> 1));
                    lat += dlat;  // Akumulasi delta

                    // Reset untuk decode longitude
                    shift = 0;
                    result = 0;
                    
                    // Decode longitude (delta encoding)
                    do {
                        if (index >= len) break;
                        b = encoded.charCodeAt(index++) - 63;
                        result |= (b & 0x1f) << shift;
                        shift += 5;
                    } while (b >= 0x20);
                    
                    // Decode delta longitude (two's complement)
                    const dlng = ((result & 1) !== 0 ? ~(result >> 1) : (result >> 1));
                    lng += dlng;  // Akumulasi delta

                    // Konversi ke koordinat aktual dan tambahkan ke array
                    poly.push([lat / factor, lng / factor]);
                }
            } catch (error) {
                console.error('Error decoding polyline:', error);
                return [];
            }
            
            return poly;
        }

        // ============================================
        // FUNGSI MENDAPATKAN RUTE JALAN
        // ============================================
        
        /**
         * Mendapatkan rute jalan dari restoran ke lokasi pelanggan menggunakan OSRM API
         * OSRM (Open Source Routing Machine) adalah routing engine untuk menghitung rute jalan
         * @param {Object} from - Koordinat titik awal {lat, lng}
         * @param {Object} to - Koordinat titik tujuan {lat, lng}
         */
        function getRoute(from, to) {
            // Simpan lokasi pelanggan untuk digunakan nanti saat update info
            const customerLocation = to;
            
            // Simpan rute lama untuk dihapus nanti setelah rute baru berhasil dibuat
            const oldRouteLine = routeLine;

            // Buat URL untuk request rute ke OSRM API
            // overview=full: dapatkan detail lengkap rute
            // geometries=polyline6: gunakan format polyline6 untuk presisi lebih tinggi (6 desimal)
            // steps=true: sertakan informasi step-by-step rute
            const routeUrl = `https://router.project-osrm.org/route/v1/driving/${from.lng},${from.lat};${to.lng},${to.lat}?overview=full&alternatives=false&geometries=polyline6&steps=true`;
            
            // Request rute dari OSRM API
            fetch(routeUrl)
                .then(response => {
                    // Cek jika response berhasil
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('OSRM API response:', data);
                    // Cek jika rute berhasil didapatkan
                    if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                        try {
                            const route = data.routes[0];
                            const encodedPolyline = route.geometry;  // Encoded polyline dari OSRM
                            
                            // Gunakan jarak dari response OSRM (dalam meter, konversi ke km)
                            // Ini lebih akurat karena menggunakan jarak jalan sebenarnya, bukan jarak lurus
                            const routeDistance = route.distance ? (route.distance / 1000) : 0;
                            
                            // Decode polyline dengan precision 6 (polyline6 format)
                            const coordinates = decodePolyline(encodedPolyline, 6);
                            
                            // Validasi: pastikan decoding berhasil
                            if (!coordinates || coordinates.length === 0) {
                                throw new Error('Failed to decode polyline');
                            }
                            
                            // Jika jarak dari OSRM tidak tersedia, hitung dari koordinat
                            const calculatedDistance = routeDistance || calculateRouteDistance(coordinates);
                            
                            // Konversi koordinat ke format LatLng array untuk Leaflet
                            const latlngs = coordinates.map(coord => [coord[0], coord[1]]);
                            
                            // Buat polyline (garis rute) dengan styling yang mengikuti lekukan jalan
                            const newRouteLine = L.polyline(latlngs, {
                                color: "#0066ff",      // Warna biru yang lebih kontras
                                weight: 6,             // Ketebalan garis 6px
                                opacity: 1,            // Opacity 100% untuk visibilitas maksimal
                                smoothFactor: 0.5,     // Faktor smoothing rendah = lebih detail, mengikuti lekukan jalan lebih baik
                                lineCap: 'round',     // Ujung garis bulat
                                lineJoin: 'round',    // Sambungan garis bulat
                                dashArray: null       // Garis solid (tidak putus-putus)
                            });
                            
                            // Tambahkan ke map
                            newRouteLine.addTo(map);
                            
                            console.log('Route line created and added to map:', newRouteLine);
                            console.log('Route line coordinates count:', latlngs.length);
                            
                            // Hapus rute lama jika ada, setelah rute baru berhasil dibuat dan ditambahkan ke map
                            if (oldRouteLine) {
                                map.removeLayer(oldRouteLine);
                            }
                            
                            // Set routeLine ke rute baru yang sudah dibuat
                            routeLine = newRouteLine;
                            
                            // Bawa garis rute ke depan agar terlihat di atas elemen lain
                            routeLine.bringToFront();
                            
                            // Update view peta untuk memastikan rute dan kedua marker terlihat dengan baik
                            setTimeout(() => {
                                if (restoMarker && customerMarker) {
                                    const group = new L.featureGroup([restoMarker, customerMarker, routeLine]);
                                    const bounds = group.getBounds();
                                    const center = bounds.getCenter();
                                    
                                    // Tentukan zoom level berdasarkan jarak - semakin dekat semakin tinggi zoom
                                    let zoomLevel;
                                    if (calculatedDistance < 0.5) {
                                        // Jarak sangat dekat (< 500m), zoom sangat dekat
                                        zoomLevel = 16;
                                    } else if (calculatedDistance < 1) {
                                        // Jarak dekat (< 1 km), zoom dekat
                                        zoomLevel = 15;
                                    } else if (calculatedDistance < 3) {
                                        // Jarak sedang (1-3 km), zoom sedang-dekat
                                        zoomLevel = 14;
                                    } else if (calculatedDistance < 5) {
                                        // Jarak agak jauh (3-5 km), zoom sedang
                                        zoomLevel = 13;
                                    } else {
                                        // Jarak jauh (> 5 km), zoom agak jauh tapi tetap terlihat jelas
                                        zoomLevel = 12;
                                    }
                                    
                                    // Gunakan setView dengan zoom level yang sudah ditentukan
                                    // Ini akan zoom in lebih dekat dibanding fitBounds
                                    map.setView(center, zoomLevel);
                                    
                                    // Jika jarak terlalu jauh, gunakan fitBounds dengan padding minimal
                                    if (calculatedDistance > 10) {
                                        map.fitBounds(bounds.pad(0.1), {
                                            padding: [30, 30]
                                        });
                                    }
                                }
                            }, 200);
                            
                            // Update informasi jarak dan ongkir dengan jarak rute yang sebenarnya
                            updateInfo(customerLocation, calculatedDistance);
                        } catch (decodeError) {
                            console.error('Error decoding polyline:', decodeError);
                            // Jika gagal, lempar error untuk trigger fallback
                            throw decodeError;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching route:', error);
                    // Fallback: coba lagi dengan format polyline standard (precision 5)
                    const fallbackUrl = `https://router.project-osrm.org/route/v1/driving/${from.lng},${from.lat};${to.lng},${to.lat}?overview=full&alternatives=false&geometries=polyline`;
                    fetch(fallbackUrl)
                        .then(response => response.json())
                        .then(data => {
                            // Cek jika rute berhasil didapatkan dari fallback
                            if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                                try {
                                    const route = data.routes[0];
                                    const encodedPolyline = route.geometry;
                                    
                                    // Gunakan jarak dari response OSRM (dalam meter, konversi ke km)
                                    const routeDistance = route.distance ? (route.distance / 1000) : 0;
                                    
                                    // Decode dengan precision 5 (format polyline standard)
                                    const coordinates = decodePolyline(encodedPolyline, 5);
                                    
                                    // Validasi decoding
                                    if (!coordinates || coordinates.length === 0) {
                                        throw new Error('Failed to decode polyline');
                                    }
                                    
                                    // Hitung jarak jika tidak tersedia dari OSRM
                                    const calculatedDistance = routeDistance || calculateRouteDistance(coordinates);
                                    
                                    // Buat polyline dengan koordinat yang sudah di-decode
                                    const latlngs = coordinates.map(coord => [coord[0], coord[1]]);
                                    
                                    // Buat polyline baru
                                    const newRouteLine = L.polyline(latlngs, {
                                        color: "#0066ff",      // Warna biru yang lebih kontras
                                        weight: 6,             // Ketebalan garis 6px
                                        opacity: 1,            // Opacity 100% untuk visibilitas maksimal
                                        smoothFactor: 0.5,
                                        lineCap: 'round',
                                        lineJoin: 'round',
                                        dashArray: null        // Garis solid (tidak putus-putus)
                                    });
                                    
                                    // Tambahkan ke map
                                    newRouteLine.addTo(map);
                                    
                                    console.log('Fallback route line created and added to map:', newRouteLine);
                                    console.log('Fallback route line coordinates count:', latlngs.length);
                                    
                                    // Hapus rute lama jika ada, setelah rute baru berhasil dibuat dan ditambahkan ke map
                                    if (oldRouteLine) {
                                        map.removeLayer(oldRouteLine);
                                    }
                                    
                                    // Set routeLine ke rute baru yang sudah dibuat
                                    routeLine = newRouteLine;
                                    
                                    routeLine.bringToFront();
                                    
                                    // Update view peta untuk memastikan rute dan kedua marker terlihat dengan baik
                                    setTimeout(() => {
                                        if (restoMarker && customerMarker) {
                                            const group = new L.featureGroup([restoMarker, customerMarker, routeLine]);
                                            const bounds = group.getBounds();
                                            const center = bounds.getCenter();
                                            
                                            // Tentukan zoom level berdasarkan jarak - semakin dekat semakin tinggi zoom
                                            let zoomLevel;
                                            if (calculatedDistance < 0.5) {
                                                // Jarak sangat dekat (< 500m), zoom sangat dekat
                                                zoomLevel = 16;
                                            } else if (calculatedDistance < 1) {
                                                // Jarak dekat (< 1 km), zoom dekat
                                                zoomLevel = 15;
                                            } else if (calculatedDistance < 3) {
                                                // Jarak sedang (1-3 km), zoom sedang-dekat
                                                zoomLevel = 14;
                                            } else if (calculatedDistance < 5) {
                                                // Jarak agak jauh (3-5 km), zoom sedang
                                                zoomLevel = 13;
                                            } else {
                                                // Jarak jauh (> 5 km), zoom agak jauh tapi tetap terlihat jelas
                                                zoomLevel = 12;
                                            }
                                            
                                            // Gunakan setView dengan zoom level yang sudah ditentukan
                                            // Ini akan zoom in lebih dekat dibanding fitBounds
                                            map.setView(center, zoomLevel);
                                            
                                            // Jika jarak terlalu jauh, gunakan fitBounds dengan padding minimal
                                            if (calculatedDistance > 10) {
                                                map.fitBounds(bounds.pad(0.1), {
                                                    padding: [30, 30]
                                                });
                                            }
                                        }
                                    }, 200);
                                    
                                    // Update informasi dengan jarak rute
                                    updateInfo(customerLocation, calculatedDistance);
                                } catch (decodeError) {
                                    console.error('Error decoding fallback polyline:', decodeError);
                                    // Tampilkan pesan error ke user
                                    showToast("Gagal memuat rute. Silakan coba lagi.", 'error');
                                }
                            }
                        })
                        .catch(err => {
                            // Jika fallback juga gagal, log error
                            console.error('Fallback route fetch also failed:', err);
                        });
                });
        }

        // ============================================
        // INISIALISASI SAAT HALAMAN DIMUAT
        // ============================================
        
        // ============================================
        // FUNGSI JAM OPERASIONAL JAKARTA
        // Fitur untuk menampilkan jam real-time Jakarta dan
        // membatasi akses berdasarkan jam operasional
        // ============================================

        /**
         * Mendapatkan waktu Jakarta (WIB - UTC+7)
         * Fungsi ini mengkonversi waktu lokal ke waktu Jakarta
         * @returns {Date} Objek Date dengan waktu Jakarta
         */
        function getJakartaTime() {
            const now = new Date();
            // Jakarta adalah UTC+7
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const jakartaTime = new Date(utc + (7 * 3600000));
            return jakartaTime;
        }

        /**
         * Memformat waktu menjadi string HH:MM:SS
         * @param {Date} date - Objek Date
         * @returns {string} String waktu dalam format HH:MM:SS
         */
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        /**
         * Mengecek apakah saat ini dalam jam operasional
         * Menggunakan OPERATING_HOURS.open (7) dan OPERATING_HOURS.close (17)
         * @returns {boolean} true jika dalam jam operasional (07:00 - 17:00), false jika tidak
         */
        function isOperatingHours() {
            const jakartaTime = getJakartaTime();
            const currentHour = jakartaTime.getHours();
            return currentHour >= OPERATING_HOURS.open && currentHour < OPERATING_HOURS.close;
        }

        /**
         * Update tampilan jam real-time Jakarta
         * Update jam di navbar dan di pesan closed hours setiap detik
         */
        function updateJakartaTime() {
            const jakartaTime = getJakartaTime();
            const timeString = formatTime(jakartaTime);
            
            // Update jam di navbar
            const navbarTimeElement = document.getElementById('jakartaTime');
            if (navbarTimeElement) {
                navbarTimeElement.textContent = timeString;
            }
            
            // Update jam di closed hours message
            const closedHoursTimeElement = document.getElementById('closedHoursTime');
            if (closedHoursTimeElement) {
                closedHoursTimeElement.textContent = timeString;
            }
        }

        /**
         * Mengatur tampilan berdasarkan jam operasional
         * Menampilkan/menyembunyikan konten utama dan pesan tutup
         */
        function checkOperatingHours() {
            const isOpen = isOperatingHours();
            const mainContent = document.getElementById('mainContent');
            const closedHoursContainer = document.getElementById('closedHoursContainer');
            
            if (isOpen) {
                // Toko buka - tampilkan konten utama
                if (mainContent) {
                    mainContent.style.display = 'block';
                }
                if (closedHoursContainer) {
                    closedHoursContainer.style.display = 'none';
                }
            } else {
                // Toko tutup - tampilkan pesan tutup
                if (mainContent) {
                    mainContent.style.display = 'none';
                }
                if (closedHoursContainer) {
                    closedHoursContainer.style.display = 'flex';
                }
            }
        }

        /**
         * Inisialisasi jam real-time dan pengecekan jam operasional
         * Dipanggil saat halaman dimuat untuk memulai update jam dan pengecekan
         */
        function initOperatingHours() {
            // Update jam setiap detik
            updateJakartaTime();
            setInterval(updateJakartaTime, 1000);
            
            // Cek jam operasional setiap detik (untuk handle transisi buka/tutup)
            checkOperatingHours();
            setInterval(checkOperatingHours, 1000);
        }

        /**
         * Event listener untuk inisialisasi peta saat halaman selesai dimuat
         * Dipanggil sekali saat DOM sudah siap
         * 
         * CATATAN: Inisialisasi jam operasional selalu dijalankan untuk menampilkan jam real-time
         * Peta dan menu hanya diinisialisasi jika dalam jam operasional
         */
        window.addEventListener('DOMContentLoaded', () => {
            // Inisialisasi jam operasional terlebih dahulu (selalu dijalankan)
            // Ini akan menampilkan jam real-time di navbar dan mengecek jam operasional
            initOperatingHours();
            
            // Hanya inisialisasi peta dan menu jika dalam jam operasional
            // Ini menghemat resource saat toko tutup
            if (isOperatingHours()) {
                initMap();  // Inisialisasi peta
                populateFilterDropdown();  // Populate dropdown filter
                renderMenu();  // Render menu items
            }
            
            // Event listener untuk menutup modal saat klik di luar modal
            const modal = document.getElementById('foodDetailModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeFoodDetail();
                    }
                });
            }

            // Event listener untuk menutup modal dengan tombol ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && currentModalItemId) {
                    closeFoodDetail();
                }
            });
        });
    </script>
</body>

</html>
